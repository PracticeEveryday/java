## 자바의 메모리영역

자바는 크게 3가지 영역으로 메모리를 나눌 수 있다.
1. 메서드 영역 << 클래스의 정보 저장
2. 스택 영역 << 프로그램이 실행되는 영역
3. 힙 영역 << 인스턴스가 생성되는 곳(배열, new 생성자 등)

클래스의 정보(클래스의 생성 코드, 클래스의 메서드)는 모두 메서드 영역에 들어간다.   
런타임 상수("hello", 123)와 static 변수 또한 메서드 영역에 들어간다.

> 참고
> 멀티 스레드 환경으로 프로그램을 실행할 경우 각 스레드들은 자신의 스택 영역을 가지고 있는다.

프로그램이 실행되는 스택 영역에서 인스턴스를 만들면 인스턴스는 힙 영역에 저장된다.   
힙 영역에서 생성된 인스턴스의 메소드를 접근 할 때는, 메서드 영역에 있는 메서드 코드를 사용한다.   
즉, 같은 클래스에서 생성된 인스턴스들은 메서드 영역에 있는 메서드 코드들을 공유하는 것이다.   

<< 이것은 자바의 최적화 영역이다.

> 어떻게 코드들을 찾아 갈 수 있을까?
> 
> 이것은, 컴파일러와 링커의 영역이다.
> 컴파일을 하면 컴파일러는 외부 메서드와 데이터의 경로를 모르기 때문에 빈 영역으로 놔둔다.   
> 이 때, 어떤 데이터와 메서드가 외부에서 들어온 것이고, 각각의 파일에서 외부로 나갈 수 있는 데이터와 함수를 사상표로 매핑해 놓는다.   
> 이 후 링커가 외부 파일들과의 연결을 할 때 주소가 적혀져 있지 않은 곳을 각 파일의 사상 매핑표를 찾아 이어 준다.   
> 이렇게 컴파일과 링커 과정을 거치게 되면 외부에 있는 주소들이 자리잡게 되는 것이다.   
> 
> 내가 책을 쓸 때 인용을 하는 것을 생각해보자.   
> 
> 나는 1장을 쓰고 있는 데 아직 5장을 쓰지 않았다. 하지만 1장에서 5장을 참조하고 싶을 때 몇 쪽에 있는 글을 참조할 지 모른다.   
> 그렇기에 1장에서 참조하는 5장의 페이지를 N페이지라고 지정해 놓는다.   
> 
> 이 후 5장까지 작성한 후 책을 완성하면 그 때서야 N페이지라고 참조해 놓은 곳에 적절한 페이지로 수정하는 것이다.   
> 
> 위 과정이, 컴파일러와 링커가 하는 과정이라고 보면 될 것 같다.


### 스택
스택 구조는 LIFO로 나중에 들어온 것이 먼저 나가는 것이다.

> 🤔 그럼, 내가 마지막에 들어왔을 때 어디로 돌아가야 되는 지는 어떻게 알까?

그것은 스택 프레임 안에 있다.   
스택 프레임에 저장되는 데이터 중 하나는 어디서 부터 왔는 지에 대한 주소 데이터도 포함되어 있다.   
포함된 함수의 역할이 끝나고, 내가 호출된 자리로 돌아가야 할 때 컴파일러는 스택 프레임 안에 있는 주소를 확인하고 해당 호출부로 `JUMP` 할 수 있도록 처리 한다.


